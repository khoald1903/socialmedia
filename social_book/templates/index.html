{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="{% static 'favicon.png' %}" rel="icon" type="image/png">
    <title>ImageNet</title>
    <link rel="stylesheet" href="{% static 'assets/css/icons.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/uikit.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/style.css' %}">
    <link rel="stylesheet" href="{% static 'assets/css/tailwind.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f7f7;
            color: #333;
        }

        .header {
                    background-color: #f8f9fa; /* Light background color */
                    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1); /* Subtle shadow for depth */
                    padding: 20px 40px; /* Increased padding for more space */
                    border-radius: 8px; /* Rounded corners */
                    margin-bottom: 20px; /* Space below the header */
                    display: flex; /* Flexbox for alignment */
                    align-items: center; /* Vertically center the content */
                    justify-content: center; /* Center the content horizontally */
                }

                .header h1 {
                    font-size: 2rem; /* Larger font size for the title */
                    color: #343a40; /* Darker color for better contrast */
                    margin: 0; /* Remove default margin */
                }

                .header a {
                    text-decoration: none; /* Remove underline from links */
                    color: #007bff; /* Blue color for links */
                    transition: color 0.3s ease; /* Smooth transition for color change */
                }

                .header a:hover {
                    color: #0056b3; /* Darker blue on hover */
                }

                .header b {
                    font-weight: bold; /* Bold for the username */
                }


        .header_inner {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header_inner .left-side {
            display: flex;
            align-items: center;
        }

        #logo h1 {
            color: #007bff;
            font-size: 24px;
            font-weight: bold;
        }

        .header_inner .right-side {
            display: flex;
            align-items: center;
        }

        .header_inner a {
            margin-left: 20px;
            text-decoration: none;
            color: #007bff;
            font-weight: 500;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .post-container {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            transition: transform 0.2s;
        }

        .post-container:hover {
            transform: translateY(-5px);
        }

        .post-header,
        .post-footer {
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .post-footer {
            border-top: 1px solid #eee;
            border-bottom: none;
        }

        .post-image img {
            width: 100%;
            height: auto;
            display: block;
        }

        .post-caption {
            margin-bottom: 15px;
            font-size: 16px;
            color: #555;
        }

        .post-comments {
            margin-top: 20px;
        }

        .comment {
            padding: 10px;
            margin-bottom: 10px;
            background-color: #f1f1f1;
            border: 1px solid #ddd;
            border-radius: 8px;
            position: relative;
        }

        .comment strong {
            color: #007bff;
            font-weight: bold;
        }

        .comment p {
            margin: 0;
            color: #555;
        }

        .add-comment {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
        }

        .add-comment textarea {
            resize: none;
            padding: 15px;
            margin-bottom: 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            width: 100%;
            height: 100px;
        }

        .add-comment button {
            padding: 10px 20px;
            border: none;
            background-color: #007bff;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
            font-size: 14px;
            align-self: flex-end;
        }

        .add-comment button:hover {
            background-color: #0056b3;
        }

        .no-comments {
            font-style: italic;
            color: #888;
        }

        .full-content {
            display: none;
        }

        .read-more {
            color: #007bff;
            cursor: pointer;
        }

        .options-button {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: transparent;
            border: none;
            color: #888;
            font-size: 16px;
            cursor: pointer;
        }

        .delete-button {
            display: none;
            background-color: #ff4d4d;
            border: none;
            color: white;
            padding: 5px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 12px;
        }

        .delete-button:hover {
            background-color: #cc0000;
        }

        .comment:hover .delete-button {
            display: block;
        }

        .suggestion-box {
            background: #fff;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .suggestion-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
        }

        .suggestion-item img {
            border-radius: 50%;
            width: 40px;
            height: 40px;
        }

        .suggestion-item .info {
            margin-left: 10px;
        }

        .suggestion-item .info span {
            display: block;
        }

        .suggestion-item .info .name {
            font-weight: bold;
            color: #333;
        }

        .suggestion-item .info .bio {
            color: #777;
            font-size: 14px;
        }

        .suggestion-item .view-button {
            padding: 5px 10px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-decoration: none;
            color: #007bff;
            font-weight: 500;
        }

        .suggestion-item .view-button:hover {
            background-color: #007bff;
            color: #fff;
            border-color: #007bff;
        }
        
    </style>


    <script>
        function toggleContent(id) {
            const dots = document.getElementById(`dots-${id}`);
            const moreText = document.getElementById(`more-${id}`);
            const btnText = document.getElementById(`btn-${id}`);

            if (dots.style.display === "none") {
                dots.style.display = "inline";
                btnText.innerHTML = "Xem thêm";
                moreText.style.display = "none";
            } else {
                dots.style.display = "none";
                btnText.innerHTML = "Thu gọn";
                moreText.style.display = "inline";
            }
        }
        function confirmDelete(event) {
            event.preventDefault(); // Prevent the default action of the link

            if (confirm("Bạn có chắc chắn muốn xóa bài viết này không?")) {
                // If user confirms, proceed with the deletion
                window.location.href = event.currentTarget.href;
            } else {
                // If user cancels, do nothing
                return false;
            }
        }
    </script>
</head>

<body>
    <header>
        <div class="header_inner">
            <form action="/search" method="POST">
                {% csrf_token %}
                <div class="left-side">
                    <div id="logo" class="uk-hidden@s">
                        <a href="home.html">
                            <b>
                                <h1 style="text-transform: uppercase;">Social Book</h1>
                            </b>
                        </a>
                    </div>

                    <input type="text" name="username" placeholder="Tìm kiếm...">&nbsp; &nbsp;
                    <button type="submit"><i class="fa fa-search fa-1x"></i></button>
                </div>
            </form>
            <div class="right-side lg:pr-4">
                <a href="/profile/{{ user.username }}">
                    Xin chào <b>{{ user.username }}&nbsp; &nbsp; &nbsp;</b>
                </a>
                <a href="#"
                    class="bg-pink-500 flex font-bold hidden hover:bg-pink-600 hover:text-white inline-block items-center lg:block max-h-10 mr-4 px-4 py-2 rounded shadow text-white">
                    <ion-icon name="add-circle" class="-mb-1 mr-1 opacity-90 text-xl uilus-circle"></ion-icon> Bài viết
                    mới
                </a>
                <div uk-dropdown="pos: top-right;mode:click; animation: uk-animation-slide-bottom-small"
                    class="header_dropdown">
                    <div class="px-4 py-3 -mx-5 -mt-4 mb-5 border-b">
                        <h4>Tải ảnh lên</h4>
                    </div>
                    <div class="flex justify-center flex-center text-center">
                        <div class="flex flex-col choose-upload text-center">
                            <div
                                class="bg-gray-100 border-2 border-dashed flex flex-col h-24 items-center justify-center relative w-full rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="w-12">
                                    <path
                                        d="M5.5 13a3.5 3.5 0 01-.369-6.98 4 4 0 117.753-1.977A4.5 4.5 0 1113.5 13H11V9.413l1.293 1.293a1 1 0 001.414-1.414l-3-3a1 1 0 00-1.414 0l-3 3a1 1 0 001.414 1.414L9 9.414V13H5.5z" />
                                    <path d="M9 13h2v5a1 1 0 11-2 0v-5z" />
                                </svg>
                            </div>
                            <form action="upload" method="POST" enctype="multipart/form-data">
                                {% csrf_token %}
                                <p class="my-3 leading-6"> Tải ảnh lên</p>
                                <div>
                                    <input type="file" name="image_upload">
                                    <textarea class="button soft-warning small" name="caption"
                                        placeholder="Bài viết..."></textarea>
                                    <br>
                                    <button class="button bg-blue-700" type="submit">Đăng tải</button>
                                </div>
                            </form>
                        </div>
                        <div class="uk-flex uk-flex-column choose-upload" hidden>
                            <div
                                class="mx-auto flex flex-col h-24 items-center justify-center relative w-full rounded-lg">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                    class="w-12">
                                    <path fill-rule="evenodd"
                                        d="M2 9.5A3.5 3.5 0 005.5 13H9v2.586l-1.293-1.293a1 1 0 00-1.414 1.414l3 3a1 1 0 001.414 0l3-3a1 1 0 00-1.414-1.414L11 15.586V13h2.5a4.5 4.5 0 10-.616-8.958 4.002 4.002 0 10-7.753 1.977A3.5 3.5 0 002 9.5zm9 3.5H9V8a1 1 0 012 0v5z"
                                        clip-rule="evenodd" />
                                </svg>
                            </div>
                            <p class="my-3 leading-6"> Import videos from YouTube <br> Copy / Paste your video link here
                            </p>
                            <form class="uk-grid-small" uk-grid>
                                {% csrf_token %}
                                <div class="uk-width-expand">
                                    <input type="text" class="uk-input uk-form-small bg-gray-200"
                                        style="box-shadow:none" placeholder="Paste link">
                                </div>
                                <div class="uk-width-auto">
                                    <button type="submit" class="button soft-warning -ml-2">Import</button>
                                </div>
                            </form>
                            <a href="#" class="uk-text-muted mt-3 uk-link"
                                uk-toggle="target: .choose-upload; animation: uk-animation-slide-left-small, uk-animation-slide-right-medium; queued: true">
                                Or Upload Video
                            </a>
                        </div>
                    </div>
                    <div class="px-4 py-3 -mx-5 -mb-4 mt-5 border-t text-sm">Kích thước ảnh tối đa là 999MB</div>
                </div>
                <a href="#">
                    <img src="{{ user_profile.profileimg.url }}" class="header-avatar" alt="">
                </a>
                <div uk-drop="mode: click;offset:9" class="header_dropdown profile_dropdown border-t">
                    <ul>
                        <li><a href="/settings">Tài khoản</a></li>
                        <li><a href="logout">Đăng xuất</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </header>

    <div class="container m-auto">
        <div class="lg:flex justify-center lg:space-x-10 lg:space-y-0 space-y-5">
            <div class="space-y-5 flex-shrink-0 lg:w-7/12">
                {% for post in posts reversed %}
                <div class="bg-white shadow rounded-md -mx-2 lg:mx-0">
                    <div class="flex justify-between items-center px-4 py-3">
                        <div class="flex flex-1 items-center space-x-4">
                            <span class="block font-semibold">
                                <a href="/profile/{{ post.user }}">@{{ post.user }}</a>
                            </span>
                        </div>
                        {% if post.user == user.username %}
                        <div>
                            <a href="#">
                                <i class="icon-feather-more-horizontal text-2xl hover:bg-gray-200 rounded-full p-2 transition duration-300 ease-in-out"></i>

                            </a>
                            <div class="bg-white w-56 shadow-md mx-auto p-2 mt-12 rounded-md text-gray-500 hidden text-base border border-gray-100"
                                uk-drop="mode: click;pos: bottom-right">
                                <ul class="space-y-1">
                                    <li>
                                        <a href="/delete_post/{{post.id}}"
                                            class="flex items-center px-3 py-2 text-red-500 hover:bg-red-100 hover:text-red-500 rounded-md"
                                            onclick="return confirmDelete(event)">
                                            <i class="uil-trash-alt mr-1"></i> Xóa bài viết
                                        </a>
                                    </li>
                                </ul>
                            </div>

                        </div>
                        {% endif %}
                    </div>
                    <div class="post-caption px-4">
                        <p>{{ post.caption }}</p>
                    </div>
                    <div uk-lightbox>
                        <a href="{{ post.image.url }}">
                            <img src="{{ post.image.url }}" alt="">
                        </a>
                    </div>

                    <div class="py-3 px-4 space-y-3">
                        <div class="flex space-x-4 lg:font-bold">
                            <a href="/like-post?post_id={{ post.id }}" class="flex items-center space-x-2">
                                <div class="p-2 rounded-full text-black">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor"
                                        width="25" height="25" class="">
                                        <path
                                            d="M2 10.5a1.5 1.5 0 113 0v6a1.5 1.5 0 01-3 0v-6zM6 10.333v5.43a2 2 0 001.106 1.79l.05.025A4 4 0 008.943 18h5.416a2 2 0 001.962-1.608l1.2-6A2 2 0 0015.56 8H12V4a2 2 0 00-2-2 1 1 0 00-1 1v.667a4 4 0 01-.8 2.4L6.8 7.933a4 4 0 00-.8 2.4z" />
                                    </svg>
                                    {% if post.no_of_likes == 0 %}
                                    {% else %}
                                    <p>{{ post.no_of_likes }} người thích</p>
                                    {% endif %}
                                </div>
                            </a>
                            <a href="{{ post.image.url }}" class="flex items-center space-x-2 flex-1 justify-end"
                                download>
                                <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" width="25"
                                    height="25" preserveAspectRatio="xMidYMid meet" viewBox="0 0 16 16">
                                    <g fill="currentColor">
                                        <path
                                            d="M8.5 1.5A1.5 1.5 0 0 1 10 0h4a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h6c-.314.418-.5.937-.5 1.5v6h-2a.5.5 0 0 0-.354.854l2.5 2.5a.5.5 0 0 0 .708 0l2.5-2.5A.5.5 0 0 0 10.5 7.5h-2v-6z" />
                                    </g>
                                </svg>
                            </a>
                        </div>
                        <div class="post-comments">
                            {% for comment in post.comments.all %}
                            <div class="comment">
                                <a href="/profile/{{ comment.user.username}}"><strong>{{ comment.user.username }}</strong></a>:
                                <span>{{ comment.content|slice:":50" }}</span>
                                {% if comment.content|length > 50 %}
                                <span id="dots-{{ comment.id }}">...</span>
                                <span id="more-{{ comment.id }}" class="full-content">{{ comment.content|safe }}</span>
                                <span class="read-more" id="btn-{{ comment.id }}"
                                    onclick="toggleContent({{ comment.id }})">Xem thêm</span>
                                {% endif %}
                                {% if comment.user == user %}
                                <form action="{% url 'delete_comment' comment.id %}" method="POST"
                                    class="delete-comment-form">
                                    {% csrf_token %}
                                    <button type="submit" class="delete-button">Xóa</button>
                                </form>
                                {% endif %}
                            </div>
                            {% empty %}
                            <p class="no-comments">Chưa có bình luận nào</p>
                            {% endfor %}
                        </div>

                        <!-- Add a comment -->
                        <form action="{% url 'post_comment' post.id %}" method="POST" class="add-comment">
                            {% csrf_token %}
                            <textarea name="content" placeholder="Thêm bình luận..."></textarea>
                            <button type="submit">Bình luận</button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>

            <div class="lg:w-5/12">
                <div class="bg-white shadow-md rounded-md overflow-hidden">
                    <div class="bg-gray-50 border-b border-gray-100 flex items-baseline justify-between py-4 px-6">
                        <h2 class="font-semibold text-lg">Gợi ý theo dõi</h2>
                    </div>
                    <div class="divide-gray-300 divide-gray-50 divide-opacity-50 divide-y px-4">
                        {% for suggestion in suggestions_username_profile_list %}
                        <div class="flex items-center justify-between py-3">
                            <div class="flex flex-1 items-center space-x-4">
                                <a href="/profile/{{ suggestion.user }}">
                                    <img src="{{ suggestion.profileimg.url }}"
                                        class="bg-gray-200 rounded-full w-10 h-10">
                                </a>
                                <div class="flex flex-col">
                                    <span class="block capitalize font-semibold">{{ suggestion.user }}</span>
                                    <span class="block capitalize text-sm">{{ suggestion.bio }}</span>
                                </div>
                            </div>
                            <a href="/profile/{{ suggestion.user }}"
                                class="border border-gray-200 font-semibold px-4 py-1 rounded-full hover:bg-pink-600 hover:text-white hover:border-pink-600">
                                Xem
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts ================================================== -->
    <script src="{% static 'assets/js/tippy.all.min.js' %}"></script>
    <script src="{% static 'assets/js/jquery-3.3.1.min.js' %}"></script>
    <script src="{% static 'assets/js/uikit.js' %}"></script>
    <script src="{% static 'assets/js/simplebar.js' %}"></script>
    <script src="{% static 'assets/js/custom.js' %}"></script>
    <script src="https://unpkg.com/ionicons@5.2.3/dist/ionicons.js"></script>
</body>

</html>